<meta charset="utf-8">
<script src="jquery-3.6.1.slim.min.js"></script>

<style>
@font-face {
  font-family: frontpage;
  src: url('frontpageneue.otf') format('opentype');
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
  background: #000;
  font-family: frontpage;
  font-size: 96px;
  line-height: 1;
}
#controls {
  position: absolute;
  right: 0;
  text-align: right;
  display: flex;
  flex-direction: column;
}
section {
  margin: 0;
  padding: 0;
  display: flex;
  position: absolute;
}
#top {
  left: 0;
  top: 0;
}
#bottom {
  left: 500;
  top: 0;
}
.row {
  transition: opacity 300ms;
  white-space: pre;
}
.hidden {
  opacity: 0;
  transition: none;
}
.panel {
  padding: 12px;
  text-align: center;
}
.panel.left {
  background: #222;
}
.panel.right {
  background: #333;
}
.top.panel {
  width: 208px;
  height: 832px;
}
.bottom.panel {
  width: 416px;
  height: 1040px;
  overflow: hidden;
  color: white;
}
.digit {
  display: inline-block;
  width: 1ch;
  text-align: center;
}
.panel[theme='red'] {
  background: #eb1c23;
}
.panel[theme='blue'] {
  background: #4aa1cc;
}
.strike {
  text-decoration: line-through;
}
</style>

<body>
  <div id="controls">
    <button onclick='document.fullscreenElement ? document.exitFullscreen() : document.body.requestFullscreen()' type=button>Full screen</button>
    <button onclick='fi = 0; nextFrameMillis = Date.now()' type=button>Restart</button>
    <button onclick='nextFrameMillis = Date.now()' type=button>Next</button>
  </div>
  <section id=top>
    <div id="top-left" class="panel top left">
    </div>
    <div id="top-right" class="panel top right">
    </div>
  </section>

  <section id=bottom>
    <div id="bottom-left" class="panel bottom left">
    </div>
    <div id="bottom-right" class="panel bottom right">
    </div>
  </section>
</body>

<script>
const frames = [
  {
    duration: 5,
    left: {theme: 'red', rows: ['#ClimateClock']},
    right: {theme: 'blue', rows: ['#ActInTime']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['THE', 'SCIENCE', 'IS', 'CLEAR']},
    right: {theme: 'blue', rows: ['OUR', 'CARBON', 'BUDGET', 'IS', 'RUNNING', 'OUT']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['WE', 'HAVE', 'LESS', 'THAN', '7', 'YEARS']},
    right: {theme: 'blue', rows: ['TO', 'PROTECT', 'OUR PLANET', '& PEOPLE']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['DELAY', '=', 'DENIAL']},
    right: {theme: 'blue', rows: ['WE MUST', 'END', 'FOSSIL', 'FUELS', 'BY', '/2070', '/2060', '/2050', '/2040', '2030']}
  },
  {
    duration: 15,
    left: {theme: 'red', rows: ['DEADLINE'], animation: 'deadline'},
    right: {theme: 'red', rows: ['OUR', 'WINDOW', 'OF', 'HOPE', ' ', 'LET\'S', '#ActInTime']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['THE', 'EARTH', 'HAS A', 'DEADLINE']},
    right: {theme: 'blue', rows: ['BUT', 'WE HAVE', 'MANY', 'LIFELINES']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['SOLUTIONS', 'EXIST']},
    right: {theme: 'blue', rows: ['WE CAN', 'BUILD A', 'JUST &', 'LIVABLE', 'WORLD']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['PRESIDENTS,', 'MINISTERS,', 'NEGOTIATORS,', 'DELEGATES...', 'BE BOLD!']},
    right: {theme: 'blue', rows: ['THE', 'FUTURE', 'IS COUNTING', 'ON YOU...']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['THE EYES', 'OF THE', 'WORLD', 'ARE ON', 'COP27']},
    right: {theme: 'blue', rows: ['/BLAH', '/BLAH', '/BLAH', 'COURAGE', 'JUSTICE', 'SPEED']}
  },
  {
    duration: 5,
    left: {theme: 'red', rows: ['#ClimateClock']},
    right: {theme: 'blue', rows: ['#ActInTime']}
  },
  {
    duration: 10,
    left: {theme: 'blue', rows: ['LIFELINE'], animation: 'renewables'},
    right: {theme: 'blue', rows: ['WE MUST', 'ACHIEVE', '100%', 'RENEWABLES', 'BEFORE', '2030', 'TO STAY', 'BELOW', '1.5Â° C']}
  },
  {
    duration: 10,
    left: {theme: 'blue', rows: ['LIFELINE'], animation: 'indigenous'},
    right: {theme: 'blue', rows: ['INDIGENOUS', 'LANDS IN', 'INDIGENOUS', 'HANDS', 'IS A KEY', 'CLIMATE', 'SOLUTION']}
  },
  {
    duration: 10,
    left: {theme: 'blue', rows: ['LIFELINE'], animation: 'lossdamage'},
    right: {theme: 'blue', rows: ['THE BIGGEST', 'POLLUTERS', 'MUST PAY', 'THOSE', 'MOST', 'IMPACTED']}
  },
  {
    duration: 10,
    left: {theme: 'red', rows: ['DEADLINE'], animation: 'deadline'},
    right: {theme: 'red', rows: ['THIS IS', 'OUR', 'WINDOW', 'OF HOPE', ' ', 'LET\'S', '#ActInTime']}
  }
];

var fi = -1;
var startFrameMillis = 0;
var nextFrameMillis = 0;
var si = 0;
var panels = {
  left: {
    node: $('#bottom-left'),
    rows: [],
  },
  right: {
    node: $('#bottom-right'),
    rows: [],
  }
};

function tick() {
  var now = Date.now();
  if (now > nextFrameMillis) {
    fi = (fi + 1) % frames.length;
    var durationMillis = frames[fi].duration * 2 * 1000;
    nextFrameMillis = (nextFrameMillis || now) + durationMillis;
    startFrameMillis = nextFrameMillis - durationMillis;
  }
  si = 1;
  drawPanel(panels.left, frames[fi].left, now - startFrameMillis);
  si += 2;
  drawPanel(panels.right, frames[fi].right, now - startFrameMillis);
  setTimeout(tick, 20);
}

function drawPanel(panel, frame, millis) {
  while (panel.rows.length < frame.rows.length) {
    panel.rows.push($('<div>').addClass('row').appendTo(panel.node));
  }
  var revealed = millis / 500;
  for (var ri = 0; ri < panel.rows.length; ri++) {
    var content = frame.rows[ri] || '';
    var strike = false;
    if (content.startsWith('/')) {
      content = content.substring(1);
      strike = true;
    }
    panel.rows[ri].text(content);
    panel.rows[ri].toggleClass('strike', strike);
    panel.rows[ri].toggleClass('hidden', si >= revealed);
    if (frame.rows[ri]) si++;
  }
  panel.node.attr('theme', frame.theme);
}

tick();
</script>
